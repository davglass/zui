<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
 <meta charset="utf-8">
 <title>Test ZUI ScrollSnapper</title>
</head>
<style>
li {width:200px;height:300px;border:2px solid #000;background#f00}
</style>
<body class="yui3-skin-sam">
<ul>
 <li>this is page 1</li>
 <li>this is page 2</li>
 <li>this is page 3</li>
 <li>this is page 4</li>
 <li>this is page 5</li>
 <li>this is page 6</li>
 <li>this is page 7</li>
 <li>this is page 8</li>
 <li>this is page 9</li>
 <li>this is page 0</li>
</ul>
</body>
<script src="http://yui.yahooapis.com/3.8.0/build/yui/yui-min.js"></script>
<script type="text/javascript" src="../../build/gallery-zui-scrollsnapper/gallery-zui-scrollsnapper-debug.js"></script> 
<script>
YUI({
    coverage: ['gallery-zui-scrollsnapper'],
    filter: (window.location.search.match(/[?&]filter=([^&]+)/) || [])[1] || 'raw'
}).use('test', 'node-event-simulate', 'gallery-zui-scrollsnapper', function (Y) {
    var scroll = (new Y.ScrollView({srcNode: 'ul', height: 400, width: 300, render: true})).plug(Y.zui.ScrollSnapper),
        testSuite = new Y.Test.Suite('ZUI scrollhelper'),
        pageH = Y.one('li').get('offsetHeight'),
        dragTime = 800,
        flickTime = 50,
        testDelay = 1200,

        doDrag = function (widget, y, ms) {
            var node = widget.get('contentBox'),
                xy = [10, 10];

            node.simulate('mousedown', {clientX: xy[0], clientY: xy[1]});
            node.simulate('mousemove', {clientX: xy[0], clientY: xy[1] + y});
            Y.later(ms, null, function () {
                node.simulate('mouseup', {clientX: xy[0], clientY: xy[1] + y});
            });
        },

        testScroll = function (test, widget, y, time, diff) {
            var startPage = widget.pages.get('index'),
                startOffset = widget.get('scrollY');
            doDrag(widget, y, time);
            test.wait(function () {
                Y.Assert.areSame(startPage + diff, widget.pages.get('index'));
                Y.Assert.areSame(startOffset + diff * pageH, widget.get('scrollY'));
            }, dragTime + testDelay);
        };

    testSuite.add(new Y.Test.Case({
        name: 'Test attributes',

        testAxis: function () {
            Y.Assert.isTrue(Y.Lang.isArray(scroll.pages.get('axis')));
        },

        testTotal: function () {
            Y.Assert.areSame(10, scroll.pages.get('total'));
        },

        testIndex: function () {
            Y.Assert.areSame(0, scroll.pages.get('index'));
        }
    }));

    testSuite.add(new Y.Test.Case({
        name: 'Test plugin methods',

        testPrev: function () {
            scroll.pages.prev();
            Y.Assert.areSame(0, scroll.pages.get('index'));
            Y.Assert.areSame(0, scroll.get('scrollX'));
            Y.Assert.areSame(0, scroll.get('scrollY'));
        },

        testNext: function () {
            scroll.pages.next();
            this.wait(function () {
                Y.Assert.areSame(1, scroll.pages.get('index'));
                Y.Assert.areSame(0, scroll.get('scrollX'));
                Y.Assert.areSame(pageH, scroll.get('scrollY'));
            }, testDelay);
        },

        testNextNext: function () {
            scroll.pages.next().next();
            this.wait(function () {
                Y.Assert.areSame(3, scroll.pages.get('index'));
                Y.Assert.areSame(0, scroll.get('scrollX'));
                Y.Assert.areSame(3 * pageH, scroll.get('scrollY'));
            }, testDelay);
        },

        testPrevPrev: function () {
            scroll.pages.prev().prev();
            this.wait(function () {
                Y.Assert.areSame(1, scroll.pages.get('index'));
                Y.Assert.areSame(0, scroll.get('scrollX'));
                Y.Assert.areSame(1 * pageH, scroll.get('scrollY'));
            }, testDelay);
        }
    }));

    testSuite.add(new Y.Test.Case({
        name: 'Test drag hehaviors',

        testDragDownBack: function () {
            testScroll(this, scroll, -100, dragTime, 0);
        },

        testDragDownOK: function () {
            testScroll(this, scroll, -250, dragTime, 1);
        },

        testFlickDown: function () {
            testScroll(this, scroll, -50, flickTime, 1);
        },

        testFlickDownFar: function () {
            testScroll(this, scroll, -120, flickTime, 2);
        },

        testDragUpBack: function () {
            testScroll(this, scroll, 100, dragTime, 0);
        },

        testDragUpOK: function () {
            testScroll(this, scroll, 250, dragTime, -1);
        },

        testFlickUp: function () {
            testScroll(this, scroll, 50, flickTime, -1);
        },

        testFlickUpFar: function () {
            testScroll(this, scroll, 120, flickTime, -2);
        }
    }));

    Y.Test.Runner.add(testSuite);
    Y.Test.Runner.run();
});
</script>
</html>
